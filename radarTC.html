<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>&#x964D;&#x96E8;&#x96F7;&#x9054; - &#x5357;&#x5C6F;&#x96F7;&#x9054;&#x56DE;&#x6CE2;&#x5716;&#x8207;&#x6240;&#x5728;&#x4F4D;&#x7F6E;</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <h2>&#x964D;&#x96E8;&#x96F7;&#x9054; - &#x5357;&#x5C6F;&#x96F7;&#x9054;&#x56DE;&#x6CE2;&#x5716;&#x8207;&#x6240;&#x5728;&#x4F4D;&#x7F6E;</h2>
    <div id="map"></div>
	
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
	
	<div>
                   <button id="radarTP" >北</button>
                   <button id="radarTC" >中</button>
                   <button id="radarKH" >南</button>
    </div>
    <script>
		const radarTP = document.getElementById('radarTP');
		const radarTC = document.getElementById('radarTC');
		const radarKH = document.getElementById('radarKH');
		var radarUrl="";
		let map; // 全域變數
		let currentOverlay; // 目前的圖層	

			radarUrl = "https://cwaopendata.s3.ap-northeast-1.amazonaws.com/Observation/O-A0084-002.png";
			showMap(radarUrl);
			
		radarTP.addEventListener('click', function() {
			radarUrl = "https://cwaopendata.s3.ap-northeast-1.amazonaws.com/Observation/O-A0084-001.png";
			showMap(radarUrl);
		});
		
		radarTC.addEventListener('click', function() {
			radarUrl = "https://cwaopendata.s3.ap-northeast-1.amazonaws.com/Observation/O-A0084-002.png";
			showMap(radarUrl);
		});
		
		radarKH.addEventListener('click', function() {
			radarUrl = "https://cwaopendata.s3.ap-northeast-1.amazonaws.com/Observation/O-A0084-003.png";
			showMap(radarUrl);
		});


		function showMap(radarUrl) {
			const bounds = [[22.6, 119.1], [25.6, 122.1]];
			const urlWithNoCache = radarUrl + '?t=' + new Date().getTime();

			// 只初始化一次地圖
			if (!map) {
				map = L.map('map').setView([24.135, 120.648], 9);

				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(
						pos => {
							const lat = pos.coords.latitude;
							const lon = pos.coords.longitude;
							L.marker([lat, lon]).addTo(map)
								.bindPopup("您的位置").openPopup();
							map.panTo([lat, lon]);
						},
						err => {
							console.error("定位失敗:", err);
							alert("無法取得地理位置");
						}
					);
				}
			}

			// 清除舊圖層
			if (currentOverlay) {
				map.removeLayer(currentOverlay);
			}

			// 加入新的雷達圖層
			currentOverlay = L.imageOverlay(urlWithNoCache, bounds).addTo(map);
		}
    </script>

</body>
</html>
